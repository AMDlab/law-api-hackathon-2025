# 審査機序図生成スキル

建築基準法の条文から審査機序図（kijo diagram）JSONを生成する。

## トリガー

- 「機序図を作成」「機序図を生成」
- 「法○条の機序図」「令○条の機序図」
- 条文指定での機序図作成リクエスト

## スキーマ

**必ず `schemas/kijo-diagram.schema.json` を読み込んでから作業すること。**

## 作業フロー

### STEP 1: スキーマ読み込み
```
schemas/kijo-diagram.schema.json を読む
```

### STEP 2: 条文取得
法令MCP（`law`）を使用して対象条文の全文を取得。

```
law.get_article(law_id="325AC0000000201", article="43", paragraph="1")
```

### STEP 3: 法文構造分析

1. **規制文特定**: 「〜しなければならない」「〜してはならない」を特定
2. **適合命題変換**:
   - 「Aでなければならない」→「Aである」
   - 「Bであれば Aでなければならない」→「Bではない OR Aである」
3. **ただし書き分析**: 例外条件をAND/OR構造で表現
4. **各号展開**: 「各号のいずれか」は個別に取得して構造化
5. **別表参照**: 「別表第一」等の参照があれば別表内容も取得

### STEP 4: JSON生成

出力先: `data/diagrams/{法令ID}/{条番号}_kijo.json`

**ファイル命名規則:**
- 機序図: `A{条}_P{項}_kijo.json`（例: `A22_P1_kijo.json`）
- 枝番あり: `A{条}_{枝番}_P{項}_kijo.json`（例: `A20_3_P2_kijo.json`）

## 重要ルール

### 入力情報の処理ノード分離（必須）

**禁止**: 複数の入力情報を1つの処理ノードでまとめて取得

```json
// ❌ 悪い例
{ "id": "proc-001", "title": "建築物諸元の特定", "description": "高さ・構造種別・階数を特定" }
// edges: proc-001 → info-001, proc-001 → info-002, proc-001 → info-003
```

**正しい**: 入力情報ごとに個別の処理ノードを作成

```json
// ✅ 良い例
{ "id": "proc-001", "title": "高さの特定" }      // → info-001
{ "id": "proc-002", "title": "構造種別の特定" }  // → info-002
{ "id": "proc-003", "title": "階数の特定" }      // → info-003
```

**例外**: 計算処理（複数入力→1出力）は1つの処理ノードで可
- 例: `Ac = A - Asp × 0.5` → info-A, info-Asp → proc → info-Ac

### 別表参照の展開

条文に「別表第一（い）欄（五）項」等がある場合、具体的内容を取得して反映。

```json
// ❌ 悪い例
{ "title": "別表第一(五)(六)該当", "description": "別表第一の用途" }

// ✅ 良い例
{
  "title": "倉庫・車庫等の用途",
  "description": "別表第一（い）欄（五）項（倉庫等）又は（六）項（自動車車庫等）",
  "remarks": "(五)倉庫その他これに類するもの、(六)自動車車庫、自動車修理工場"
}
```

## 法令ID一覧

| 法令 | ID |
|---|---|
| 建築基準法 | 325AC0000000201 |
| 建築基準法施行令 | 325CO0000000338 |
| 建築基準法施行規則 | 325M50004000040 |

## 関連条項記述規則

形式: `{法令略称}::A{条}:P{項}:I{号}`

- 建築基準法 = `法`
- 建築基準法施行令 = `令`
- 建築基準法施行規則 = `規則`

例: `法::A43:P1` → 法第43条第1項

## 図式構成ルール

1. **主体のノード化**: 対象主体（建築物等）は独立ノードにせず`subject`属性で参照
2. **接続規則**: 情報→処理→情報の流れ。処理は1つ以上の出力を持つ
3. **レイアウト**: 左から右へ。最終情報（適否判定）は右端
4. **閾値分離**: 「1000㎡以下」は数値情報と判定処理に分離

## 参考

- 詳細手順: `prompts/機序図生成プロンプト.md`
- 手引書: `prompts/審査機序図作成手引書202403.md`
